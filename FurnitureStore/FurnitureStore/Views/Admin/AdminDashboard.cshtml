@model Tuple<IEnumerable<User>, IEnumerable<ProductPayment>,IEnumerable<Payment>, IEnumerable<SectionReport>, IEnumerable<Message>, IEnumerable<Testimonial>, IEnumerable<FurnitureReport>>
@{
    ViewData["Title"] = "AdminDashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
@functions{
    void SectionsSales()
    {
        foreach(SectionReport sectionReport in Model.Item4.OrderByDescending(s=>s.TotalSales).Take(5))///
        {
            <tr>
                <td>@sectionReport.Name</td>
                <td>@sectionReport.TotalSales</td>
            </tr>
        }
    }
    void FurnitureSales()
    {
        
        foreach(FurnitureReport furniture in Model.Item7.OrderByDescending(f=>f.TotalSales).Take(5))///
        {
            <tr>
                <td>@furniture.Name</td>
                <td>@furniture.Category</td>
                <td class="text-right">@string.Format("{0:C}",furniture.Price)</td>
                <td class="text-right">@string.Format("{0:C}",furniture.TotalSales)</td>
            </tr>
        }
    }
    async Task TodayTestimonial()
    {
        foreach(Testimonial testimonial in Model.Item6.OrderByDescending(item=>item.Id))
        {
            User user = Model.Item1.Where(user => user.Id == testimonial.SenderId).FirstOrDefault();
            <div class="au-message__item unread">
                <div class="au-message__item-inner">
                    <div class="au-message__item-text">
                        <div class="avatar-wrap">
                            <div class="avatar">
                                @if (user != null)
                                {
                                    <img src="~/Images/@user.Imagepath" alt="John Smith">
                                }
                                else
                                {
                                    <img src="~/Images/defaultUserImage.png" alt="John Smith">
                                }
                            </div>
                        </div>
                        <div class="text">
                            @if (user != null)
                            {
                                <h5 class="name">@user.Firstname @user.Lastname</h5>
                            }
                            else
                            {
                                <h5 class="name">Unknown</h5>
                            }
                            <p>
                                @if(testimonial.Text.Length>15)
                                { 
                                    @testimonial.Text.Substring(0, 15)
                                    <span><span><a asp-action="Details" asp-controller="Testimonials" asp-route-id="@testimonial.Id">show more</a></span></span>
                                }
                                else 
                                { 
                                    @testimonial.Text
                                }
                            </p>
                        @testimonial.SendTime.ToString("hh:mm tt")
                        </div>
                    </div>
                    <div class="au-message__item-time">
                        <a asp-action="Details" asp-controller="Testimonials" asp-route-id="@testimonial.Id">Details</a>
                    </div>
                </div>
            </div>
        } 
    }
        
    async Task TodayMessages()
    {
        foreach (Message message in Model.Item5)
        {
            <div class="au-task__item au-task__item--danger">
                <div class="au-task__item-inner">
                    <h6>
                        @if (message.Subject.Length > 25)
                        {
                            @message.Subject.Substring(0, 25)
                            <span><a asp-action="Details" asp-controller="Messages" asp-route-id="@message.Id" style="color:blue">show more</a></span>
                        }
                        else
                        {
                            @message.Subject
                        }
                   </h6>
                    <p class="task">
                        @if (message.Text.Length > 25)
                        {
                            @message.Text.Substring(0, 25)
                            <span><a asp-action="Details" asp-controller="Messages" asp-route-id="@message.Id" style="color:blue;">show more</a></span>
                        }
                        else
                        {
                            @message.Text
                        }
                    </p>
                    <span class="time">@message.SendTime.ToString("hh:mm tt")</span>
                    <p>
                        <a asp-action="Details" asp-controller="Messages" asp-route-id="@message.Id">Details</a> |
                        <a href="mailto:@message.Email?subject">Replay</a> 
                    </p>
                </div>
            </div>
        }
    }
}



@*<h2>Admin Dashboard</h2>*@

<!-- MAIN CONTENT-->
<div class="main-content">
    <div class="section__content section__content--p30">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <div class="overview-wrap">
                        <h2 class="title-1">overview</h2>
                    </div>
                </div>
            </div>
            <div class="row m-t-25">
                <div class="col-sm-6 col-lg-3">
                    <div class="overview-item overview-item--c1">
                        <div class="overview__inner">
                            <div class="overview-box clearfix">
                                <div class="icon">
                                    <i class="zmdi zmdi-account-o"></i>
                                </div>
                                <div class="text">
                                    <h2>@Model.Item1.Count()</h2>
                                    <span>Members</span>
                                </div>
                            </div>
                            <div class="overview-chart">
                                @*<canvas id="widgetChart1"></canvas>*@
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="overview-item overview-item--c2">
                        <div class="overview__inner">
                            <div class="overview-box clearfix">
                                <div class="icon">
                                    <i class="zmdi zmdi-shopping-cart"></i>
                                </div>
                                <div class="text">
                                    <h2>@Model.Item2.Sum(item=>item.Quantity)</h2>
                                    <span>Items solid</span>
                                </div>
                            </div>
                            <div class="overview-chart">
                                @*<canvas id="widgetChart2"></canvas>*@
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="overview-item overview-item--c3">
                        <div class="overview__inner">
                            <div class="overview-box clearfix">
                                <div class="icon">
                                    <i class="zmdi zmdi-calendar-note"></i>
                                </div>
                                <div class="text">
                                    <h2>@Model.Item3.Count()</h2>
                                    <span>Orders</span>
                                </div>
                            </div>
                            <div class="overview-chart">
                                @*<canvas id="widgetChart3"></canvas>*@
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-3">
                    <div class="overview-item overview-item--c4">
                        <div class="overview__inner">
                            <div class="overview-box clearfix">
                                <div class="icon">
                                    <i class="zmdi zmdi-money"></i>
                                </div>
                                <div class="text">
                                    <h2>@string.Format("{0:0.00}",Model.Item2.Sum(item=>item.Price*item.Quantity))</h2><!--REVIEW!!-->
                                    <span>Total Sales</span>
                                </div>
                            </div>
                            <div class="overview-chart">
                                @*<canvas id="widgetChart4"></canvas>*@
                            </div>
                        </div>
                    </div>
                </div>
            </div>  
            <div class="row">
                <div class="col-lg-8">
                    <div class="au-card recent-report">
                        <div class="au-card-inner">
                            <div class="chart-info">
                                <p class="title-2" style="display:inline">Sales Summary</p>
                                <div class="chart-info__left">
                                    <div class="chart-note">
                                        <span class="dot dot--blue"></span>
                                        <span>products</span>
                                    </div>
                                    <div class="chart-note mr-0">
                                        <span class="dot dot--green"></span>
                                        <span>orders</span>
                                    </div>
                                </div>
                            </div>
                            <div class="recent-report__chart">
                                <canvas id="recent-rep-chart-orders"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="au-card chart-percent-card">
                        <div class="au-card-inner">
                            <h3 class="title-2 tm-b-5">Users</h3>
                            <div class="row no-gutters">
                                <div class="col-xl-12">
                                    <canvas id="pieChart" width="600" height="635"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-9">
                @if (Model.Item7.Count() != 0)
                    {
                        <h2 class="title-1 m-b-25">Earnings By Items</h2>
                        <div class="table-responsive table--no-card m-b-40">
                            <table class="table table-borderless table-striped table-earning">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Section</th>
                                        <th>Price</th>
                                        <th>Total Sales</th>
                                        
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        FurnitureSales();
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                </div>
                <div class="col-lg-3">
                    @if (Model.Item4.Count() != 0)
                    {
                        <h2 class="title-1 m-b-25">Top Sections</h2>
                        <div class="au-card au-card--bg-blue au-card-top-countries m-b-40">
                            <div class="au-card-inner">
                                <div class="table-responsive">
                                    <table class="table table-top-countries">
                                        <tbody>
                                            @{
                                                SectionsSales();

                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
            <div class="row">
                <div class="col-lg-6">
                    <div class="au-card au-card--no-shadow au-card--no-pad m-b-40">
                        <div class="au-card-title" style="background-image:url('images/bg-title-01.jpg');">
                            <div class="bg-overlay bg-overlay--blue"></div>
                            <h3>
                                <i class="zmdi zmdi-account-calendar"></i>Messages
                            </h3>
                        </div>
                        <div class="au-task js-list-load">
                            <div class="au-task__title">
                                <p>You received @Model.Item5.Count() message today</p>
                            </div>
                            <div class="au-task-list js-scrollbar3">
                            @{
                                 await TodayMessages();
                            }
                                
                            </div>
                            <div class="au-task__footer">
                                <a asp-action="Index" asp-controller="Messages">View all messages</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="au-card au-card--no-shadow au-card--no-pad m-b-40">
                        <div class="au-card-title" style="background-image:url('images/bg-title-02.jpg');">
                            <div class="bg-overlay bg-overlay--blue"></div>
                            <h3>
                                <i class="zmdi zmdi-comment-text"></i>Testmonials
                            </h3>
                        </div>
                        <div class="au-inbox-wrap js-inbox-wrap">
                            <div class="au-message js-list-load">
                                <div class="au-message__noti">
                                    <p>
                                        You have
                                        <span>@Model.Item6.Count()</span>

                                        new testimonals today
                                    </p>
                                </div>
                                <div class="au-message-list">
                                        @{
                                            await TodayTestimonial();
                                        }
                                </div>
                                <div class="au-message__footer">
                                    <a  asp-action="Index" asp-controller="Testimonials">See all testimonials</a>
                                </div>
                            </div>
                            <div class="au-chat">
                                <div class="au-chat__title">
                                    <div class="au-chat-info">
                                        <div class="avatar-wrap online">
                                            <div class="avatar avatar--small">
                                                <img src="~/AdminAssets/images/icon/avatar-02.jpg" alt="John Smith">
                                            </div>
                                        </div>
                                        <span class="nick">
                                            <a href="#">John Smith</a>
                                        </span>
                                    </div>
                                </div>
                                <div class="au-chat__content">
                                    <div class="recei-mess-wrap">
                                        <span class="mess-time">12 Min ago</span>
                                        <div class="recei-mess__inner">
                                            <div class="avatar avatar--tiny">
                                                <img src="~/AdminAssets/images/icon/avatar-02.jpg" alt="John Smith">
                                            </div>
                                            <div class="recei-mess-list">
                                                <div class="recei-mess">Lorem ipsum dolor sit amet, consectetur adipiscing elit non iaculis</div>
                                                <div class="recei-mess">Donec tempor, sapien ac viverra</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="send-mess-wrap">
                                        <span class="mess-time">30 Sec ago</span>
                                        <div class="send-mess__inner">
                                            <div class="send-mess-list">
                                                <div class="send-mess">Lorem ipsum dolor sit amet, consectetur adipiscing elit non iaculis</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="au-chat-textfield">
                                    <form class="au-form-icon">
                                        <input class="au-input au-input--full au-input--h65" type="text" placeholder="Type a message">
                                        <button class="au-input-icon">
                                            <i class="zmdi zmdi-camera"></i>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <div class="copyright">
                        <p>Copyright © 2018 Colorlib. All rights reserved. Template by <a href="https://colorlib.com">Colorlib</a>.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END MAIN CONTENT-->
<!-- END PAGE CONTAINER-->
@using Newtonsoft.Json;
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<script>
    var ctx = document.getElementById("pieChart").getContext("2d");
    var myPieChart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: @Html.Raw(JsonConvert.SerializeObject(ViewBag.Labels)),
            datasets: [{
                data: @Html.Raw(JsonConvert.SerializeObject(ViewBag.Data)),
                backgroundColor: [ "#36a2eb","#ff6384"],
            }]
        }
    });
</script>


<script>
    const brandProduct = 'rgba(0,181,233,0.8)'
    const brandService = 'rgba(0,173,95,0.8)'

    var elements = 10
    var ctx = document.getElementById("recent-rep-chart-orders");
    if (ctx) {
      ctx.height = 250;
      var myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October' , 'November' , 'December'],
          datasets: [
            {
              label: 'My First dataset',
              backgroundColor: brandService,
              borderColor: 'transparent',
              pointHoverBackgroundColor: '#fff',
              borderWidth: 0,
              data: @Html.Raw(JsonConvert.SerializeObject(ViewBag.Orders))
            },
            {
              label: 'My Second dataset',
              backgroundColor: brandProduct,
              borderColor: 'transparent',
              pointHoverBackgroundColor: '#fff',
              borderWidth: 0,
              data: @Html.Raw(JsonConvert.SerializeObject(ViewBag.Amounts))
            }
          ]
        },
        options: {
          maintainAspectRatio: true,
          legend: {
            display: false
          },
          responsive: true,
          scales: {
            xAxes: [{
              gridLines: {
                drawOnChartArea: true,
                color: '#f2f2f2'
              },
              ticks: {
                fontFamily: "Poppins",
                fontSize: 12
              }
            }],
            yAxes: [{
              ticks: {
                beginAtZero: true,
                maxTicksLimit: 5,
                stepSize: 50,
                max: 200,
                fontFamily: "Poppins",
                fontSize: 12
              },
              gridLines: {
                display: true,
                color: '#f2f2f2'

              }
            }]
          },
          elements: {
            point: {
              radius: 0,
              hitRadius: 10,
              hoverRadius: 4,
              hoverBorderWidth: 3
            }
          }
        }
      });
    }
</script>